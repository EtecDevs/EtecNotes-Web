<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Teste Firebase Connection</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        h1 { margin-top: 0; }
        .status {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
        }
        .success {
            border-left-color: #4CAF50;
        }
        .warning {
            border-left-color: #ff9800;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        pre {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
        .loader {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Teste de Conex√£o Firebase</h1>
        <p>Este teste verifica se sua aplica√ß√£o consegue conectar aos servidores do Firebase.</p>
        
        <div id="results"></div>
        
        <div style="margin-top: 30px;">
            <button onclick="testarLogin()" id="btnLogin">üîê Testar Login (aluno@teste.com)</button>
            <button onclick="testarConfig()" id="btnConfig">‚öôÔ∏è Verificar Configura√ß√£o</button>
            <button onclick="testarRede()" id="btnRede">üåê Testar Rede</button>
        </div>
        
        <div id="debug" style="margin-top: 30px;"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, connectAuthEmulator } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBTwYLOnCJAEqDAxxJGn_Yb1XnD0u1XWl0",
            authDomain: "etecnotes.firebaseapp.com",
            projectId: "etecnotes",
            storageBucket: "etecnotes.firebasestorage.app",
            messagingSenderId: "268058028102",
            appId: "1:268058028102:web:4d953d3a48b7f2e6dff8bf",
            measurementId: "G-GNHEMZSM1L"
        };
        
        let app, auth;
        const results = document.getElementById('results');
        const debug = document.getElementById('debug');
        
        function addStatus(message, type = 'status') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function addDebug(title, data) {
            debug.innerHTML += `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        // Inicializar Firebase
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            addStatus('‚úÖ Firebase inicializado com sucesso', 'success');
            addDebug('üî• Configura√ß√£o Firebase', firebaseConfig);
        } catch (error) {
            addStatus(`‚ùå Erro ao inicializar Firebase: ${error.message}`, 'error');
            addDebug('‚ùå Erro de Inicializa√ß√£o', error);
        }
        
        // Teste de Login
        window.testarLogin = async function() {
            const btn = document.getElementById('btnLogin');
            btn.disabled = true;
            btn.innerHTML = 'üîÑ Testando...';
            
            addStatus('üîÑ Iniciando teste de login com aluno@teste.com...', 'warning');
            
            try {
                const startTime = Date.now();
                const userCredential = await signInWithEmailAndPassword(auth, 'aluno@teste.com', '123456');
                const endTime = Date.now();
                
                addStatus(`‚úÖ LOGIN BEM-SUCEDIDO! (${endTime - startTime}ms)`, 'success');
                addStatus(`üë§ UID: ${userCredential.user.uid}`, 'success');
                addStatus(`üìß Email: ${userCredential.user.email}`, 'success');
                addStatus(`‚úîÔ∏è Email verificado: ${userCredential.user.emailVerified}`, 'success');
                
                addDebug('üë§ Dados do Usu√°rio', {
                    uid: userCredential.user.uid,
                    email: userCredential.user.email,
                    emailVerified: userCredential.user.emailVerified,
                    metadata: userCredential.user.metadata
                });
                
                btn.innerHTML = '‚úÖ Login OK!';
                btn.style.background = '#4CAF50';
                
            } catch (error) {
                addStatus(`‚ùå ERRO NO LOGIN: ${error.code}`, 'error');
                addStatus(`üìù Mensagem: ${error.message}`, 'error');
                
                // Diagn√≥sticos espec√≠ficos
                if (error.code === 'auth/network-request-failed') {
                    addStatus('üö® PROBLEMA DE REDE DETECTADO', 'error');
                    addStatus('Poss√≠veis causas:', 'warning');
                    addStatus('1Ô∏è‚É£ Firewall bloqueando googleapis.com', 'warning');
                    addStatus('2Ô∏è‚É£ VPN ou proxy interferindo', 'warning');
                    addStatus('3Ô∏è‚É£ Antiv√≠rus bloqueando conex√£o', 'warning');
                    addStatus('4Ô∏è‚É£ DNS n√£o resolvendo corretamente', 'warning');
                    addStatus('5Ô∏è‚É£ Rel√≥gio do sistema dessincronizado', 'warning');
                }
                
                if (error.code === 'auth/user-not-found') {
                    addStatus('‚ö†Ô∏è Usu√°rio aluno@teste.com n√£o existe no Firebase Authentication', 'warning');
                    addStatus('üí° Voc√™ precisa criar este usu√°rio no Firebase Console', 'warning');
                }
                
                if (error.code === 'auth/wrong-password') {
                    addStatus('‚ö†Ô∏è Senha incorreta (esperada: 123456)', 'warning');
                }
                
                addDebug('‚ùå Detalhes do Erro', {
                    code: error.code,
                    message: error.message,
                    stack: error.stack
                });
                
                btn.innerHTML = '‚ùå Erro - Tentar Novamente';
                btn.style.background = '#f44336';
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                }, 2000);
            }
        };
        
        // Teste de Configura√ß√£o
        window.testarConfig = function() {
            addStatus('‚öôÔ∏è Verificando configura√ß√£o...', 'warning');
            
            const checks = [
                { test: firebaseConfig.apiKey, msg: 'üîë API Key configurada', ok: true },
                { test: firebaseConfig.authDomain, msg: 'üåê Auth Domain configurado', ok: true },
                { test: firebaseConfig.projectId, msg: 'üìÅ Project ID configurado', ok: true },
                { test: auth, msg: 'üî• Firebase Auth inicializado', ok: true },
            ];
            
            checks.forEach(check => {
                if (check.test) {
                    addStatus(`‚úÖ ${check.msg}`, 'success');
                } else {
                    addStatus(`‚ùå ${check.msg}`, 'error');
                }
            });
            
            addDebug('üìä Status da Configura√ß√£o', {
                firebaseInitialized: !!app,
                authInitialized: !!auth,
                config: firebaseConfig,
                currentUser: auth?.currentUser
            });
        };
        
        // Teste de Rede
        window.testarRede = async function() {
            addStatus('üåê Testando conectividade de rede...', 'warning');
            
            const endpoints = [
                { name: 'Firebase Auth', url: 'https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=' + firebaseConfig.apiKey },
                { name: 'Auth Domain', url: `https://${firebaseConfig.authDomain}/__/auth/handler` },
                { name: 'Firebase API', url: 'https://firebaseapp.com' },
                { name: 'Google APIs', url: 'https://www.googleapis.com' },
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(endpoint.url, { method: 'HEAD', mode: 'no-cors' });
                    const endTime = Date.now();
                    addStatus(`‚úÖ ${endpoint.name} - Acess√≠vel (${endTime - startTime}ms)`, 'success');
                } catch (error) {
                    addStatus(`‚ùå ${endpoint.name} - BLOQUEADO: ${error.message}`, 'error');
                }
            }
            
            // Teste de DNS
            try {
                const dns = await fetch('https://dns.google/resolve?name=etecnotes.firebaseapp.com&type=A');
                const dnsData = await dns.json();
                addStatus(`‚úÖ DNS resolve corretamente`, 'success');
                addDebug('üåê DNS Resolution', dnsData);
            } catch (error) {
                addStatus(`‚ùå Erro no DNS: ${error.message}`, 'error');
            }
        };
        
        // Executar testes autom√°ticos na inicializa√ß√£o
        window.addEventListener('load', () => {
            testarConfig();
            setTimeout(() => {
                addStatus('üí° Clique em "Testar Login" para testar a autentica√ß√£o', 'warning');
            }, 1000);
        });
    </script>
</body>
</html>
